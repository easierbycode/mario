{"version":3,"sources":["gamepad-support.ts"],"names":[],"mappings":"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","file":"gamepad-support.e17685ba.js","sourceRoot":"../src","sourcesContent":["// Gamepad support\nconst MAX_PLAYERS = 2;\nconst haveEvents  = 'ongamepadconnected' in window;\nconst controllers: {\n  [property: number]: Gamepad\n} = {};\n// D-PAD AND BUTTONS\n// (U, D, L, R, B, A, START)\nconst buttons     = {\n  U : 12,\n  D : 13,\n  L : 14,\n  R : 15,\n  B : 2,\n  A : 0,\n  S : 9\n};\nconst buttonValues = Object.values( buttons );\nconst buttonKeys = Object.keys( buttons );\n// KeyboardEvent keyCode mappings by gamepad\n// i.e. - keyCodes[0] maps to the first gamepad,\n// pressing (S)TART triggers a keypress for 83 (SPACE)\nconst keyCodes: {\n  [property: string]: number\n}[] = [\n{\n  U : 87,//(W)  //38,\n  D : 83,//(S)  //40,\n  L : 65,//(A)  //37,\n  R : 68,//(D)  //39,\n  B : 67,\n  A : 32,\n  S : 13 //(ENTER)  //83\n},\n{\n  U : 87,\n  D : 83,\n  L : 65,\n  R : 68\n}];\nconst pendingKeyupEvents  = Array( MAX_PLAYERS ).fill({\n  U : null,\n  D : null,\n  L : null,\n  R : null,\n  B : null,\n  A : null,\n  S : null\n});\n\nfunction connecthandler(e: GamepadEvent) {\n  console.log( '.. adding gamepad:' );\n  console.log( e.gamepad );\n  addgamepad( e.gamepad );\n}\n\nfunction addgamepad(gamepad: Gamepad) {\n  controllers[gamepad.index] = gamepad;\n\n  requestAnimationFrame(updateStatus);\n}\n\nfunction disconnecthandler(e: GamepadEvent) {\n  removegamepad(e.gamepad);\n}\n\nfunction removegamepad(gamepad: Gamepad) {\n  delete controllers[gamepad.index];\n}\n\nfunction updateStatus() {\n  if (!haveEvents) {\n    scangamepads();\n  }\n\n  for (\n    let controllerIdx = 0; \n    controllerIdx < Object.keys(controllers).length; \n    controllerIdx++\n  ) {\n\n    var controller  = controllers[+Object.keys(controllers)[controllerIdx]];\n\n    // HOME / PS button - enter fullscreen\n    if ( controller.buttons[16].pressed ) {\n      if ( !document.fullscreen ) {\n        document\n          .getElementsByTagName( 'canvas' )[0]\n          .requestFullscreen();\n      }      \n    }\n\n    for (let i = 0; i < buttonValues.length; i++) {\n\n        let buttonKey = buttonKeys[i];\n        var val = controller.buttons[buttonValues[i]];\n        var pressed = val.pressed;\n        let pendingKeyupEvent = pendingKeyupEvents[controllerIdx][buttonKey];\n\n        if ( pressed ) {\n\n          let keyCode = keyCodes[controllerIdx][buttonKey];\n\n          // if button is still pressed (pendingKeyupEvent),\n          // don't create / dispatch duplicate events\n          if ( pendingKeyupEvent && pendingKeyupEvent.keyCode === keyCode )  continue;\n\n          var event: any = document.createEvent('event');\n          let keyupEvent: any = document.createEvent('event');\n          event.initEvent('keydown', true, true);\n          keyupEvent.initEvent('keyup', true, true);\n          event.keyCode = keyCode;\n          keyupEvent.keyCode = keyCode;\n          document.getElementsByTagName( 'canvas' )[0].dispatchEvent( event );\n\n          pendingKeyupEvents[controllerIdx][buttonKey]  = keyupEvent;\n\n        } else if ( pendingKeyupEvent ) {\n          document.getElementsByTagName( 'canvas' )[0].dispatchEvent( pendingKeyupEvent );\n          \n          pendingKeyupEvents[controllerIdx][buttonKey] = null;\n        }\n    }\n  }\n\n  requestAnimationFrame(updateStatus);\n}\n\nfunction scangamepads() {\n  var gamepads: Gamepad[] = navigator.getGamepads();\n  for (var i = 0; i < gamepads.length; i++) {\n    if (gamepads[i]) {\n      if (gamepads[i].index in controllers) {\n        controllers[gamepads[i].index] = gamepads[i];\n      } else {\n        addgamepad(gamepads[i]);\n      }\n    }\n  }\n}\n\n\nwindow.addEventListener(\"gamepadconnected\", connecthandler);\nwindow.addEventListener(\"gamepaddisconnected\", disconnecthandler);\n\nif (!haveEvents) scangamepads();"]}